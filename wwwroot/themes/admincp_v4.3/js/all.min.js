/*!combi2015-10-08*/
$("body").on("hidden",".modal",function(){$(this).removeData("modal")}),$.openNote=function(a,b){var c=$(a).parents("tr"),d=c.hasClass("opened")?1:0;d?($(a).html('<i class="fa fa-plus-square-o"></i>'),c.removeClass("opened"),$(".cat_"+b).remove()):($(a).html('<i class="fa fa-minus-square-o"></i>'),c.addClass("opened")),$.post(location.href,{cid:b,t:d},function(a){d||c.after(a)})},$.setCookie=function(a,b){var c=30,d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3),document.cookie=a+"="+escape(b)+";expires="+d.toGMTString()+";path=/;"},$.getCookie=function(a){var b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)"));return null!=b?unescape(b[2]):null},$.delCookie=function(a){var b=new Date;b.setTime(b.getTime()-1);var c=getCookie(a);null!=c&&(document.cookie=a+"="+c+";expires="+b.toGMTString())},$.applyImage=function(a,b,c){var d='<input type="hidden" name="'+b+'" value="'+a+'" /><a><img src="'+a+'" role="btn" /></a><a class="JS_DelImg img-remove" href="javascript:;"><i class="fa fa-remove"></i> <span>移除</span></a>';$(c).html(d),$(".JS_DelImg",c).on("click",function(){$(c).empty().html('<input type="hidden" name="'+b+'" value="" />'),event.stopPropagation()})};var files=new Array;$.applyImages=function(a,b,c){$(c).empty();for(x in a){var d=a[x],e='<div class="JS_ImgItem img-item" style="position:relative;"><div class="alt"><input type="hidden" name="'+b+"["+x+'][id]" value="'+d.id+'"><input type="hidden" name="'+b+"["+x+'][src]" value="'+d.src+'"><textarea name="'+b+"["+x+'][alt]" class="form-control" placeholder="请输入图片说明">'+(d.alt?d.alt:"")+'</textarea><a href="javascript:;$(\'.alt\',\'.JS_ImgItem\').hide()" class="btn btn-primary btn-xs">确定</a></div><a class="thumb" title="'+(d.alt?d.alt:"")+'"><img src="'+d.src+'" data-id="'+d.id+'"></a><div class="operate"><a href="javascript:;" class="JS_DelImg"><i class="fa fa-remove"></i> 移除</a></div></div>';$(c).append(e)}$(".JS_ImgItem",c).on("click",function(){var a=$(this);$(".alt",c).hide(),$(".alt",a).show(),$(document).mouseup(function(b){var d=a;d.is(b.target)||0!==d.has(b.target).length||$(".alt",c).hide()}),event.stopPropagation()}),$(".JS_DelImg",c).on("click",function(){$(this).parents(".JS_ImgItem").remove()}),$(".JS_Forward",c).on("click",function(){var a=$(this).parents(".JS_ImgItem");a.prev(".JS_ImgItem").before(a)}),$(".JS_Backward",c).on("click",function(){var a=$(this).parents(".JS_ImgItem");a.next(".JS_ImgItem").after(a)}),seajs.use("/assets/js/dragsort/jquery.dragsort-0.5.2.min.js",function(a){$(c).dragsort("destroy"),$(c).dragsort({placeHolderTemplate:"<div class='img-item'></div>"})})},$.fn.loadExpress=function(a,b){var c=this;$.post("/?controller=callback&action=express&t="+a,{code:b},function(a){if("success"==a.message){var b="";$(a.result.router).each(function(a){b+="<li>",b+='<span class="ex-time">'+this.time+"</span>",b+='<span class="ex-addr">'+this.address+"</span>",b+='<span class="ex-status">'+this.statue_message+"</span>",b+="</li>"}),$(c).html(b)}},"json")},$.changeUnit=function(){var a=$("input[name=package_method]:checked").val();switch(parseInt(a)){case 1:$("[name=package_quantity]").val(0),$("#package-setting").hide();var b=$("select[name=package_unit]>option:selected").text();break;case 2:$("#package-setting").show();var b=$("input[name=package_lot_unit]").val()}$(".package-unit-text").text($("select[name=package_unit]>option:selected").text()),$(".package-unit").text(b)},$.loadAttribute=function(a,b){var c=$(".sc-attr-box");$.ajax({cache:!0,data:{cid:a,pid:b},beforeSend:function(a){$(c).empty().append('<div class="loading-box">Loading...</div>')},success:function(a){$(".loading-box").remove(),$(c).empty().append(a)},url:"/?module=admincp&controller=goods_type&action=attribute"})},$.appendCustomItem=function(){cusnum++;var a=$("#_custpl").html().replace(/@id/g,cusnum);$("#custom-input-box").append(a)},$.removeCustomItem=function(a){$("#custom-item-"+a).remove()},$.buychoose=function(a,b){$(".ipt_"+a+"_"+b).attr("disabled",!$("#chk_"+a+"_"+b+":checked").attr("id"))},$.makeSkuTable=function(){var a=$("input[name=goods_id]").val();$.post("/?module=admincp&controller=goods_type&action=sku&id="+a,$("form").serialize(),function(a){$(".JS_SkuSettings").empty().append(a),a&&$.processQuantity()})},$.setColorCode=function(a){var b=$(".color_title_"+a).val(),c=$(".color_code_"+a).val();$(".color_value_"+a).val(c+"|"+b),$.makeSkuTable()},$.appendWholesalePrice=function(a){var b=$("input[name=package_quantity]").val(),c=$("input[name=package_unit]").val(),d=$("input[name=package_lot_unit]").val()?$("input[name=package_lot_unit]").val():"包",e=b>0?2:1,f=2==e?d:c,g=$("#-prices-setting tbody").length,h=g+1,i=g+2,j=parseFloat($("input[name=brokerage]").val()),k=parseInt($("#-price-item-"+g+" input.-max-qty").val()),l=(parseInt($("#-price-item-"+i+" input.-min-qty").val()),'<tr id="-price-item-'+h+'">');l+='<td><div class="input-group"><input type="text" name="extend[wholesale_prices]['+h+'][min_qty]" class="form-control input-sm -min-qty" /><span class="input-group-addon"> ~ </span><input type="text" name="extend[wholesale_prices]['+h+'][max_qty]" class="form-control input-sm -max-qty" /> <span class="input-group-addon package-unit">'+f+"</span></div></td>",l+='<td><div class="input-group"><input type="text" name="extend[wholesale_prices]['+h+'][selling_price]" class="form-control input-sm -selling-price" iptn="selling" curid="'+h+'" /><span class="input-group-addon"> 元 </span></td>',l+='<td><div class="input-group"><input type="text" name="extend[wholesale_prices]['+h+'][processing_time]" class="form-control input-sm -processing-time" /><span class="input-group-addon"> 天 </span></td>',l+='<td><a href="javascript:void(0)" onclick="$(\'#-price-item-'+h+"').remove(); $('#-price-item-"+g+' .remove\').show(); calcLimitQty()" class="remove">移除</a></td>',l+="</tr>",$("#-prices-setting").append(l),a&&(a.min_qty&&$("#-price-item-"+h+" input.-min-qty").val(a.min_qty),a.max_qty&&$("#-price-item-"+h+" input.-max-qty").val(a.max_qty),a.supply_price&&$("#-price-item-"+h+" input.-supply-price").val(a.supply_price),a.selling_price&&$("#-price-item-"+h+" input.-selling-price").val(a.selling_price),a.processing_time&&$("#-price-item-"+h+" input.-processing-time").val(a.processing_time)),$("#-price-item-"+g+" .remove").hide(),k&&$("#-price-item-"+h+" input.-min-qty").attr("readonly",!0).val(k+1),$(".-min-qty, .-max-qty",$("#-price-item-"+h)).change(function(){var a=parseInt($(".-min-qty",$("#-price-item-"+h)).val()),b=parseInt($(".-max-qty",$("#-price-item-"+h)).val());a>b&&b&&($(".-max-qty",$("#-price-item-"+h)).val(a+1),alert("数量区间设置错误")),$("#-price-item-"+(h+1)+" input.-min-qty").val(parseInt($(".-max-qty",$("#-price-item-"+h)).val())+1),$.calcLimitQty()}),$(".-supply-price, .-selling-price",$("#-price-item-"+h)).change(function(){var a=$(this).attr("curid"),b=$(this).attr("iptn");switch(b){case"selling":$(".-supply-price",$("#-price-item-"+a)).val(($(this).val()/j).toFixed(2));break;case"supply":$(".-selling-price",$("#-price-item-"+a)).val(($(this).val()*j).toFixed(2))}})},$.processQuantity=function(){var a=0;$(".buychoose-quantity").each(function(){var b=parseInt($(this).val());return-1==b?(a=-1,!1):void(a+=parseInt($(this).val()))}),$("input[name=quantity]").val(a).attr("readonly",a?!0:!1)};